<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">

 <meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css">  
 <link rel="stylesheet" href="css/themes/jquery.mobile.icons.min.css" />  
 <link rel="stylesheet" href="css/themes/my-custom-theme.css" />
<script src="js/jquery-1.11.3.min.js"></script>
  <script src="js/jquery.mobile-1.4.5.js"></script>  
 <script src="js/jquery-1.7.min.js"></script>  
<script type="text/javascript"> 

$(function() {
      $("#new_pass").click(function() {
      var queryString = new Array();

          if (window.location.search.split('?').length > 1) {
                var params = window.location.search.split('?')[1].split('&');
                for (var i = 0; i < params.length; i++) {
                    var key = params[i].split('=')[0];
                    var value = decodeURIComponent(params[i].split('=')[1]);
                    queryString[key] = value;
                }
            }
            var myArray=queryString[key].split('|');
       var username =myArray[0];
    //  alert(username);
            $.ajax({
    url: "http://shopnearn.co.in/mobileapp/check_password.php",
           type     : 'POST',
              data: ({username:username}),
                  cache: false,
                  dataType: "text",
                  success: onSuccess
                });

                });
     $("#resultLog").ajaxError(function(event, request, settings, exception) {
          $("#resultLog").html("Error Calling: " + settings.url + "<br />HTTP Code: " + request.status);});
                   
function onSuccess(data)
        {   
                                       $("#resultLog").html("Result: " + data);
                                        
                                            //  alert(data);
document.getElementById('pass').value=data;
	var oldpass=document.getElementById('pass').value;
var oldpass1=document.getElementById('old_password');
	
	 var message = document.getElementById('oldpassword');
    //Set the colors we will be using ...
    var goodColor = "#66cc66";
    var badColor = "#ff6666";
    //Compare the values in the password field 
    //and the confirmation field
    if(oldpass == oldpass1.value){
        //The passwords match. 
        //Set the color to the good color and inform
        //the user that they have entered the correct password 
        
        oldpass1.style.backgroundColor = goodColor;
        message.style.color = goodColor;
        message.innerHTML = "Passwords Match!";
        document.getElementById('submit').disabled=false;

    }else{
        //The passwords do not match.
        //Set the color to the bad color and
        //notify the user.
        oldpass1.style.backgroundColor = badColor;
        message.style.color = badColor;
        message.innerHTML = "Passwords Do Not Match!";
                document.getElementById('old_password').value="";
        document.getElementById('submit').disabled=true;
    }

	 }
  });


function checkPass()
{
    //Store the password field objects into variables ...
    var pass1 = document.getElementById('new_pass');
    var pass2 = document.getElementById('new_pass1');
    //Store the Confimation Message Object ...
    var message = document.getElementById('confirmMessage');
    //Set the colors we will be using ...
    var goodColor = "#66cc66";
    var badColor = "#ff6666";
    //Compare the values in the password field 
    //and the confirmation field
    if(pass1.value == pass2.value){
        //The passwords match. 
        //Set the color to the good color and inform
        //the user that they have entered the correct password 
        pass2.style.backgroundColor = goodColor;
        message.style.color = goodColor;
        message.innerHTML = "Passwords Match!";
        document.getElementById('submit').disabled=false;
    }else{
        //The passwords do not match.
        //Set the color to the bad color and
        //notify the user.
        pass2.style.backgroundColor = badColor;
        message.style.color = badColor;
        message.innerHTML = "Passwords Do Not Match!";
        document.getElementById('submit').disabled=true;
    }
} 

function getname1()
  {
  var queryString = new Array();

          if (window.location.search.split('?').length > 1) {
                var params = window.location.search.split('?')[1].split('&');
                for (var i = 0; i < params.length; i++) {
                    var key = params[i].split('=')[0];
                    var value = decodeURIComponent(params[i].split('=')[1]);
                    queryString[key] = value;
                }
            }
            var myArray=queryString[key].split('|');
document.getElementById('name1').innerHTML=myArray[1];
}
   


$(function() {
      $("#submit").click(function() {
            var new_pass = $.trim($("#new_pass").val());
            var new_pass1 = $.trim($("#new_pass1").val());
            var old_password = $.trim($("#old_password").val());
            var queryString = new Array();

          if (window.location.search.split('?').length > 1) {
                var params = window.location.search.split('?')[1].split('&');
                for (var i = 0; i < params.length; i++) {
                    var key = params[i].split('=')[0];
                    var value = decodeURIComponent(params[i].split('=')[1]);
                    queryString[key] = value;
                }
            }
            var myArray=queryString[key].split('|');
       var username =myArray[0];
     if(new_pass=="" || new_pass1==""||old_password=="")
           {
           alert("Please Enter All details properly!!");  
           document.getElementById('new_pass1').value="";         
           document.getElementById('new_pass').value="";         
           }
           
     else{
            $.ajax({
    url: "http://shopnearn.co.in/mobileapp/update_change_password.php",
    //  url: "http://shopnearn.co.in/mobileapp/client_entry1.php?action=member",
           type     : 'POST',
              data: ({old_password:old_password,new_pass:new_pass,new_pass1:new_pass1,username:username}),
                  cache: false,
                  dataType: "text",
                  success: onSuccess
                });
                }
                });
     $("#resultLog").ajaxError(function(event, request, settings, exception) {
          $("#resultLog").html("Error Calling: " + settings.url + "<br />HTTP Code: " + request.status);});
                   
function onSuccess(data)
        {
        //  alert(data);
     
          $("#resultLog").html("Result: " + data);
                 alert("Password Changed Successfully...!!!!");  
        window.location.href="home1.html?member="+localStorage.getItem("shopcode")+'|'+localStorage.getItem("shopname");
         
          }
  });

function getreg1()
	{
	window.location.href="client_registration1.html?member="+localStorage.getItem("shopname");
	} 
	
	function getpass1()
	{
	window.location.href="change_password.html?memember="+localStorage.getItem("shopcode")+'|'+localStorage.getItem("shopname");
	} 
	function gethome1()
	{
	window.location.href="tieup_bill_new.html?memember="+localStorage.getItem("shopcode")+'|'+localStorage.getItem("shopname");
	} 
		function getbill1()
	{
	window.location.href="view_tbill.html?memember="+localStorage.getItem("shopcode")+'|'+localStorage.getItem("shopname");
	} 

</script>
</head>
<body>
<!--......client Registration Form........-->
<div data-role="page" id="password">
<div data-role="panel" id="overlayPanel1" data-display="overlay" data-rel="back"> 
    <ul data-role="listview">
    <li data-icon="user"><a href="tieup_profile.html?reload" style= font-size:0.9em; data-rel="external" rel="external">Company Client Profile</a></li>
  <li data-icon="shop"><a onclick="getbill1();" style= font-size:0.9em; data-rel="external" rel="external">View Bill</a></li>
   <li data-icon="user"><a onclick="getpass1();" style= font-size:0.9em; data-rel="external" rel="external">Change Password</a></li>

   <li data-icon="user"><a href="tieup_about_us.html?reload" style= font-size:0.9em; data-rel="external" rel="external">About Us</a></li>
    <li data-icon="info"><a href="tieup_faq.html?reload" style= font-size:0.9em; data-rel="external" rel="external">FAQ</a></li>
  <li data-icon="phone"><a href="tieup_contact_us.html?reload" style= font-size:0.9em; data-rel="external" rel="external">Contact Us</a></li>

  <li data-icon="power"><a href="index.html?reload" style= font-size:0.9em; data-rel="external" rel="external" >Logout</a></li>
</ul>   
</div> 

   <div data-role="header" data-position="fixed">
    <body onload="getname1();">
       <h3 style="text-align: center"><div id="name1"></div></h3>
           <a data-rel="external" rel="external"  role="button" data-role="button" data-mini="true" href="#overlayPanel1" class="ui-btn-left ui-btn-corner-all ui-btn  ui-icon-bars ui-btn-icon-notext ui-shadow" title="Home" data-form="ui-icon" data-theme="a" > 
          </a>         
       <a onclick="gethome1();" class="ui-btn ui-corner-all ui-icon-home ui-btn-icon-notext" >Home</a>
           </body> 
           </div>
                      <form name="contact_form" class="contact_form" method="post">
               <div data-role="main" class="ui-content">
               					<h3 style="color:#E67817;" class="colourclasss"  > <b>Change Password</b></h3>
               					    <hr     />
               					    <!-- <div class="ui-field-contain">
      <label for="name"> Client ID :<font color="red">*</font></label>
        <input type="text" id="username"  name="username" required>
      </div> -->
               <div class="ui-field-contain">
      <label for="old"> <font class="colourclasss">Old Password :</font><font color="red">*</font></label>
        <input type="password" id="old_password"  name="old_password" placeholder="4 digit number only" title="4 digit number only" maxlength="4" required>
        <input type="hidden" id="pass"  name="pass">
         <span id="oldpassword" class="confirmMessage"></span>    
      </div>

	
               <div class="ui-field-contain">
      <label for="new"><font class="colourclasss">New Password:</font> <font color="red">*</font></label>
        <input  id="new_pass" type="password" name="new_pass" required onkeyup="checkPass();" placeholder="4 digit number only" title="4 digit number only" maxlength="4"> 
	 </div>
               <div class="ui-field-contain">
      <label for="confirm"> <font class="colourclasss">Confirm Password:</font> <font color="red">*</font></label>
        <input  id="new_pass1" type="password" name="new_pass1" onkeyup="checkPass(); return false;" onke name="confirm_password" placeholder="4 digit number only" title="4 digit number only" maxlength="4" required>
       <span id="confirmMessage" class="confirmMessage"></span>      
	 </div>
	 
               <div class="ui-field-contain">

        <button  type="submit" class="ui-btn" id="submit"  name="submit"  disabled>Change</button>
<!--           <input type="hidden" id="memberId" name="memberId" value="<?php echo $memberId; ?>"> -->
          <input type="hidden" id="memberId" name="memberId">
      </div>
	 </div>
	    
<!--      <a  id="callAjax" data-transition="slide" data-theme="b"  class="ui-btn" data-rel="external" rel="external">Submit</a> -->
    </form>
</div>

    </div>
    <!--......client Registration Form End........-->
</body>
</html>
